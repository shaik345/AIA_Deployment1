<?xml version = '1.0' encoding = 'UTF-8'?>
<?oracle-xsl-mapper <!-- SPECIFICATION OF MAP SOURCES AND TARGETS, DO NOT MODIFY. -->
  <mapSources>
    <source type="WSDL">
      <schema location="oramds:/apps/AIAMetaData/AIAComponents/ApplicationObjectLibrary/Siebel/V1/wsdls/SWIPromotionIntegrationIO.wsdl"/>
      <rootElement name="SWIPromotionUpsert_Output" namespace="http://siebel.com/asi/SWIPromotionIntegration/"/>
    </source>
  </mapSources>
  <mapTargets>
    <target type="XSD">
      <schema location="oramds:/apps/AIAMetaData/AIAComponents/EnterpriseObjectLibrary/Core/EBO/Item/V2/ItemEBM.xsd"/>
      <rootElement name="SyncItemListResponseEBM" namespace="http://xmlns.oracle.com/EnterpriseObjects/Core/EBO/Item/V2"/>
    </target>
  </mapTargets>
  <!-- GENERATED BY ORACLE XSL MAPPER 10.1.3.4.0(build 080718.0645) AT [THU MAY 28 20:49:54 IST 2009]. -->
?>
<xsl:stylesheet version="1.0" xmlns:aia="http://www.oracle.com/XSL/Transform/java/oracle.apps.aia.core.xpath.AIAFunctions" xmlns:tns="http://siebel.com/asi/SWIPromotionIntegration/V0" xmlns:xref="http://www.oracle.com/XSL/Transform/java/oracle.tip.xref.xpath.XRefXPathFunctions" xmlns:corecomEBO="http://xmlns.oracle.com/EnterpriseObjects/Core/CommonEBO/V1" xmlns:coreEBOcust="http://xmlns.oracle.com/EnterpriseObjects/Core/Custom/CommonEBO/V1" xmlns:corecomcust="http://xmlns.oracle.com/EnterpriseObjects/Core/Custom/Common/V2" xmlns:corecom="http://xmlns.oracle.com/EnterpriseObjects/Core/Common/V2" xmlns:coreeboitem="http://xmlns.oracle.com/EnterpriseObjects/Core/EBO/Item/V2" xmlns:svcdoc="http://xmlns.oracle.com/Services/Documentation/V1" xmlns:coreitemcust="http://xmlns.oracle.com/EnterpriseObjects/Core/Custom/EBO/Item/V2" xmlns:xsdLocal="http://www.siebel.com/xml/SWIPromotionIntegrationIO" xmlns:xp20="http://www.oracle.com/XSL/Transform/java/oracle.tip.pc.services.functions.Xpath20" xmlns:bpws="http://schemas.xmlsoap.org/ws/2003/03/business-process/" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:str="http://www.oracle.com/XSL/Transform/java/java.lang.String" xmlns:xacml="urn:oasis:names:tc:xacml:2.0:policy:schema:cd:04" xmlns:ora="http://schemas.oracle.com/xpath/extension" xmlns:wsa="http://schemas.xmlsoap.org/ws/2003/03/addressing" xmlns:ehdr="http://www.oracle.com/XSL/Transform/java/oracle.tip.esb.server.headers.ESBHeaderFunctions" xmlns:orcl="http://www.oracle.com/XSL/Transform/java/oracle.tip.pc.services.functions.ExtFunc" xmlns:ids="http://xmlns.oracle.com/bpel/services/IdentityService/xpath" xmlns:hwf="http://xmlns.oracle.com/bpel/workflow/xpath" exclude-result-prefixes="xsl xref xp20 bpws ora ehdr orcl ids hwf" xmlns:dvm="http://www.oracle.com/XSL/Transform/java/oracle.tip.dvm.LookupValue">
  
<xsl:include href="xformSiebelPromotionABMToSyncItemListResponseEBM_Custom.xsl"/>
     <xsl:param name="ReqEBMParam"/>

   <xsl:variable name="fixedAmpersand">&amp;amp;amp;</xsl:variable>
   <xsl:variable name="EscapedReqEBMParam_fixed" select="str:replaceAll(string($ReqEBMParam),'\u0026(amp;)*+',$fixedAmpersand)"/>
   <xsl:variable name="EBMDataAreaVariable" select="orcl:parseEscapedXML($EscapedReqEBMParam_fixed)"/>



<!--  <xsl:variable name="EBMDataAreaVariable"
                select="orcl:parseEscapedXML($ReqEBMParam)"/>  -->

  <xsl:variable name="TargetID" select="$EBMDataAreaVariable/corecom:EBMHeader/corecom:Sender/corecom:ID"/>                 

<xsl:variable name="TargetServiceName" select="$EBMDataAreaVariable/corecom:EBMHeader/corecom:Sender/corecom:WSAddress/wsa:ReplyTo/wsa:ServiceName"/>
                
  <xsl:variable name="systemId" select="$EBMDataAreaVariable/corecom:EBMHeader/corecom:Target/corecom:ID"/>

  <xsl:variable name="senderSystemId" select="$EBMDataAreaVariable/corecom:EBMHeader/corecom:Sender/corecom:ID"/>
                
  <xsl:variable name="XREFSourceCol" select="'COMMON'"/>
  <xsl:template match="/">
    <coreeboitem:SyncItemListResponseEBM>
              <corecom:EBMHeader>
        <xsl:variable name="messageIDVariable" select="orcl:generate-guid()"/>
        <corecom:EBMID>
          <xsl:value-of select="$messageIDVariable"/>
        </corecom:EBMID>
        <corecom:EBMName>
          <xsl:text disable-output-escaping="no">{http://xmlns.oracle.com/ABCSImpl/Core/Item/V2}Item}SyncItemListResponseEBM</xsl:text>
        </corecom:EBMName>
        <corecom:EBOName>
          <xsl:text disable-output-escaping="no">{http://xmlns.oracle.com/ABCSImpl/Industry/Core/ItemComposition/V1}Item</xsl:text>
        </corecom:EBOName>
        <corecom:CreationDateTime>
          <xsl:value-of select="xp20:current-dateTime()"/>
        </corecom:CreationDateTime>
        <corecom:RequestEBMID>
          <xsl:value-of select="$EBMDataAreaVariable/corecom:EBMHeader/corecom:EBMID"/>
        </corecom:RequestEBMID>
        <corecom:VerbCode>
          <xsl:text disable-output-escaping="no">Sync</xsl:text>
        </corecom:VerbCode>
        <corecom:MessageProcessingInstruction>
          <xsl:variable name="ConfigServiceName" select="'{http://xmlns.oracle.com/ABCSImpl/Siebel/Core/SyncProductSiebelProvABCSImpl/V1}SyncProductSiebelProvABCSImpl'"/>
          <xsl:variable name="RouteToCAVS" select="aia:getServiceProperty($ConfigServiceName, 'Routing.ItemResponseEBSV2.SyncItemListResponse.RouteToCAVS', false())='true'"/>
          <corecom:EnvironmentCode>
            <xsl:choose>
              <xsl:when test="$RouteToCAVS">
                <xsl:text>CAVS</xsl:text>
              </xsl:when>
              <xsl:otherwise>
                <xsl:variable name="EnvCode" select="aia:getServiceProperty($ConfigServiceName, 'Routing.ItemResponseEBSV2.SyncItemListResponse.MessageProcessingInstruction.EnvironmentCode', false())"/>
                <xsl:choose>
                  <xsl:when test="$EnvCode!=''">
                    <xsl:value-of select="$EnvCode"/>
                  </xsl:when>
                  <xsl:otherwise>
                    <xsl:text>PRODUCTION</xsl:text>
                  </xsl:otherwise>
                </xsl:choose>
              </xsl:otherwise>
            </xsl:choose>
          </corecom:EnvironmentCode>
          <xsl:if test="$RouteToCAVS">
            <corecom:DefinitionID>
              <xsl:value-of select="aia:getServiceProperty($ConfigServiceName, 'Routing.ItemResponseEBSV2.SyncItemListResponse.CAVS.EndpointURI', false())"/>
            </corecom:DefinitionID>
          </xsl:if>
          <corecom:InstanceID>
            <xsl:value-of select="$EBMDataAreaVariable/corecom:EBMHeader/corecom:MessageProcessingInstruction/corecom:InstanceID"/>
          </corecom:InstanceID>
        </corecom:MessageProcessingInstruction>
        <corecom:Sender>
          <xsl:variable name="senderNodeVariable" select="aia:getEBMHeaderSenderSystemNode($systemId,'')"/>
          <corecom:ID>
            <xsl:value-of select="$senderNodeVariable/ID"/>
          </corecom:ID>
          <corecom:Description>
            <xsl:value-of select="$senderNodeVariable/Description"/>
          </corecom:Description>
          <corecom:IPAddress>
            <xsl:value-of select="$senderNodeVariable/IPAddress"/>
          </corecom:IPAddress>
          <corecom:CallingServiceName>
            <xsl:text disable-output-escaping="no">ItemEBSV2</xsl:text>
          </corecom:CallingServiceName>
          <corecom:Application>
            <corecom:ID>
              <xsl:value-of select="$senderNodeVariable/Application/ID"/>
            </corecom:ID>
            <corecom:Version>
              <xsl:value-of select="$senderNodeVariable/Application/Version"/>
            </corecom:Version>
          </corecom:Application>
          <corecom:ContactName>
            <xsl:value-of select="$senderNodeVariable/ContactName"/>
          </corecom:ContactName>
          <corecom:ContactEmail>
            <xsl:value-of select="$senderNodeVariable/ContactEmail"/>
          </corecom:ContactEmail>
          <corecom:ContactPhoneNumber>
            <xsl:value-of select="$senderNodeVariable/ContactPhone"/>
          </corecom:ContactPhoneNumber>
        </corecom:Sender>
       <corecom:Target>
           <corecom:ID> <xsl:value-of select="$TargetID"/> </corecom:ID>
           <corecom:ServiceName>
               <xsl:copy-of select="$TargetServiceName"/>
            </corecom:ServiceName>
           <corecom:ApplicationTypeCode>
             <xsl:value-of select="aia:getSystemType($TargetID)"/>
           </corecom:ApplicationTypeCode> 
        </corecom:Target>        
        <corecom:BusinessScope>
          <xsl:variable name="processIDVariable" select="orcl:generate-guid()"/>
          <corecom:ID/>
          <corecom:InstanceID>
            <xsl:text disable-output-escaping="no">EBIZ-to-Siebel-Product-Synchronization-Response</xsl:text>
          </corecom:InstanceID>
          <corecom:BusinessScopeTypeCode>
            <xsl:text disable-output-escaping="no">BusinessProcessBusinessProcessMessage</xsl:text>
          </corecom:BusinessScopeTypeCode>
          <corecom:EnterpriseServiceName>
            <xsl:text disable-output-escaping="no">ItemEBSItemEBS</xsl:text>
          </corecom:EnterpriseServiceName>
          <corecom:EnterpriseServiceOperationName>
            <xsl:text disable-output-escaping="no">SyncSync</xsl:text>
          </corecom:EnterpriseServiceOperationName>
        </corecom:BusinessScope>
        <corecom:EBMTracking>
          <corecom:SequenceNumber>
            <xsl:value-of select="1.0"/>
          </corecom:SequenceNumber>
          <corecom:ExecutionUnitName>
            <xsl:text disable-output-escaping="no">SyncProductSiebelProvABCSImpl.bpel</xsl:text>
          </corecom:ExecutionUnitName>
          <corecom:ImplementationCode>
            <xsl:text disable-output-escaping="no">BPEL</xsl:text>
          </corecom:ImplementationCode>
          <corecom:ActivityDateTime>
            <xsl:value-of select="xp20:current-dateTime()"/>
          </corecom:ActivityDateTime>
        </corecom:EBMTracking>
           <corecom:MessageBatch>
            <xsl:copy-of select="$EBMDataAreaVariable/corecom:EBMHeader/corecom:MessageBatch/corecom:ID"/>
            <xsl:copy-of select="$EBMDataAreaVariable/corecom:EBMHeader/corecom:MessageBatch/corecom:Name"/>
            <corecom:StatusCode>Success</corecom:StatusCode>
            <corecom:ResponseMessage/>
        </corecom:MessageBatch>
      </corecom:EBMHeader>
    <xsl:for-each select="//xsdLocal:ListOfSwipromotionIntegrationio/xsdLocal:SwiPromotionIntegrationVbc/xsdLocal:ListOfSwiPromotionVbc/xsdLocal:SwiPromotionVbc">
          <xsl:variable name="ProdName" select="xsdLocal:Name"/>  
        <coreeboitem:DataArea>
          <coreeboitem:SyncItemListResponse>
            <corecom:ItemIdentification>
              <corecom:BusinessComponentID>
                 <xsl:variable name="IntegrationID">
                  <xsl:value-of select="$EBMDataAreaVariable/coreeboitem:DataArea/coreeboitem:SyncItemList[corecomEBO:Name=$ProdName]/corecom:ItemIdentification/corecom:BusinessComponentID"/>
                </xsl:variable>  
                 <xsl:variable name="targetID">
                  <xsl:value-of select="xref:populateXRefRow('oramds:/apps/AIAMetaData/xref/ITEM_ITEMID.xref',$XREFSourceCol,$IntegrationID,$systemId,xsdLocal:Id,'ANY')"/>
                </xsl:variable>  
                 <xsl:variable name="PromotionID">
                  <xsl:value-of select="xref:populateXRefRow('oramds:/apps/AIAMetaData/xref/PROMOTION_PROMOTIONID.xref',$XREFSourceCol,$IntegrationID,$systemId,xsdLocal:Id,'ANY')"/>
                </xsl:variable>  
                <xsl:value-of select="$IntegrationID"/>
              </corecom:BusinessComponentID>
              <xsl:copy-of select="$EBMDataAreaVariable/coreeboitem:DataArea/coreeboitem:SyncItemList[corecomEBO:Name=$ProdName]/corecom:ItemIdentification/corecom:ApplicationObjectKey"/>              
            </corecom:ItemIdentification>
            <corecomEBO:InventoryLocation>
              <corecom:Identification>
                <corecom:BusinessComponentID>
                    <xsl:value-of select="$EBMDataAreaVariable/coreeboitem:DataArea/coreeboitem:SyncItemList[corecomEBO:Name=$ProdName]/corecomEBO:InventoryLocation/corecom:Identification/corecom:BusinessComponentID"/>
                </corecom:BusinessComponentID>
              </corecom:Identification>
            </corecomEBO:InventoryLocation>
          </coreeboitem:SyncItemListResponse>
        </coreeboitem:DataArea>
      </xsl:for-each>
    </coreeboitem:SyncItemListResponseEBM>
  </xsl:template>
  
   <!--  User Defined Templates  -->
  <xsl:template name="lookupOrPopulateXRef">
    <xsl:param name="xrefTableName"/>
    <xsl:param name="xrefReferenceColumnName"/>
    <xsl:param name="xrefReferenceValue"/>
    <xsl:param name="xrefColumnName"/>
    <xsl:variable name="xrefValue" select="xref:lookupXRef($xrefTableName,$xrefReferenceColumnName,$xrefReferenceValue,$xrefColumnName,false())"/>
    <xsl:choose>
      <xsl:when test="$xrefValue!=''">
        <xsl:value-of select="$xrefValue"/>
      </xsl:when>
      <xsl:otherwise>
        <xsl:value-of select="xref:populateXRefRow($xrefTableName,$xrefReferenceColumnName,$xrefReferenceValue,$xrefColumnName,orcl:generate-guid(),'ANY')"/>
      </xsl:otherwise>
    </xsl:choose>
  </xsl:template>
</xsl:stylesheet>
